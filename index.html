<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Minesweeper AI Solver</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f4f4f4;
      padding: 20px;
    }
    #controls {
      margin-bottom: 15px;
    }
    #timer {
      font-weight: bold;
      margin-left: 20px;
    }
    #grid {
      display: grid;
      gap: 2px;
      justify-content: center;
    }
    .cell {
      width: 30px;
      height: 30px;
      background-color: #ccc;
      border: 1px solid #999;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 16px;
      font-weight: bold;
    }
    .revealed {
      background-color: #e0e0e0;
    }
    .mine {
      background-color: red;
      color: white;
    }
  </style>
</head>
<body>
  <h1>Minesweeper AI Solver</h1>
  <div id="controls">
    <label>Difficulty:
      <select id="difficulty" onchange="resetGame()">
        <option value="easy">Easy</option>
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
      </select>
    </label>
    <button onclick="resetGame()">Reset</button>
    <span id="timer">Time: 0s</span>
  </div>
  <div id="grid"></div>

  <script>
    let gridSize, numMines;
    let board = [], revealed = [], timer = 0, timerInterval;

    function setDifficulty() {
      const level = document.getElementById('difficulty').value;
      if (level === 'easy') {
        gridSize = 9; numMines = 10;
      } else if (level === 'medium') {
        gridSize = 16; numMines = 40;
      } else {
        gridSize = 24; numMines = 99;
      }
      document.getElementById('grid').style.gridTemplateColumns = `repeat(${gridSize}, 30px)`;
    }

    function createBoard() {
      board = Array(gridSize * gridSize).fill(0);
      revealed = Array(gridSize * gridSize).fill(false);
      placeMines();
      calculateNumbers();
    }

    function placeMines() {
      let placed = 0;
      while (placed < numMines) {
        const idx = Math.floor(Math.random() * board.length);
        if (board[idx] !== 'M') {
          board[idx] = 'M';
          placed++;
        }
      }
    }

    function calculateNumbers() {
      for (let i = 0; i < board.length; i++) {
        if (board[i] === 'M') continue;
        let count = 0;
        const neighbors = getNeighbors(i);
        neighbors.forEach(n => {
          if (board[n] === 'M') count++;
        });
        board[i] = count;
      }
    }

    function getNeighbors(index) {
      const x = index % gridSize;
      const y = Math.floor(index / gridSize);
      const neighbors = [];

      for (let dx = -1; dx <= 1; dx++) {
        for (let dy = -1; dy <= 1; dy++) {
          if (dx === 0 && dy === 0) continue;
          const nx = x + dx;
          const ny = y + dy;
          if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize) {
            neighbors.push(ny * gridSize + nx);
          }
        }
      }
      return neighbors;
    }

    function renderBoard() {
      const grid = document.getElementById("grid");
      grid.innerHTML = '';
      for (let i = 0; i < board.length; i++) {
        const cell = document.createElement("div");
        cell.className = 'cell';
        cell.id = `cell-${i}`;
        grid.appendChild(cell);
      }
    }

    function startTimer() {
      clearInterval(timerInterval);
      timer = 0;
      document.getElementById("timer").textContent = `Time: 0s`;
      timerInterval = setInterval(() => {
        timer++;
        document.getElementById("timer").textContent = `Time: ${timer}s`;
      }, 1000);
    }

    function resetGame() {
      setDifficulty();
      createBoard();
      renderBoard();
      startTimer();
      setTimeout(() => runSolver(), 500);
    }

    async function runSolver() {
      let progress = true;
      while (progress) {
        progress = false;
        for (let i = 0; i < board.length; i++) {
          if (revealed[i]) continue;
          const neighbors = getNeighbors(i);
          const flagged = neighbors.filter(n => board[n] === 'M' && revealed[n]).length;
          const unrevealed = neighbors.filter(n => !revealed[n]);

          if (board[i] !== 'M' && board[i] > 0 && unrevealed.length > 0) {
            if (board[i] === unrevealed.length) {
              for (const n of unrevealed) {
                revealCell(n);
                await sleep(30); // Animated step
              }
              progress = true;
            }
          }
        }
      }
      clearInterval(timerInterval);
    }

    function revealCell(index) {
      if (revealed[index]) return;
      revealed[index] = true;
      const cell = document.getElementById(`cell-${index}`);
      cell.classList.add("revealed");
      const value = board[index];
      if (value === 'M') {
        cell.textContent = 'M';
        cell.classList.add("mine");
      } else if (value > 0) {
        cell.textContent = value;
      }
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    resetGame();
  </script>
</body>
</html>
